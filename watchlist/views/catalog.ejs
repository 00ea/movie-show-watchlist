<%- contentFor('body') %>

<div class="container">
  <div class="text-center mt-4 mb-5" style="animation: fadeInDown 0.8s ease-out;">
    <h1 class="card-title mb-0">Catalog</h1>
    <h5 class="card-text mb-4">View all your Movies and Shows here!</h5>
  </div>

 <!-- Search & Filter Bar -->
  <div class="card bg-secondary p-3 mb-4" style="animation: fadeInDown 0.8s ease-out;">
    <form method="GET" action="/catalog">
      <div class="row g-3 align-items-end">
        
        <!-- Search Bar -->
        <div class="col-md-4">
          <label for="searchInput" class="form-label">
            <i class="fa-solid fa-search me-1"></i>Search by Title
          </label>
          <input 
            type="text" 
            class="form-control" 
            id="searchInput" 
            name="search" 
            placeholder="Search movies & shows..."
            value="<%= currentFilter.search || '' %>"
          >
        </div>

        <!-- Filter by Type -->
        <div class="col-md-2">
          <label for="typeFilter" class="form-label">Type</label>
          <select name="type" id="typeFilter" class="form-control">
            <option value="">All Types</option>
            <option value="movie" <%= currentFilter.type === 'movie' ? 'selected' : '' %>>Movies</option>
            <option value="show" <%= currentFilter.type === 'show' ? 'selected' : '' %>>TV Shows</option>
          </select>
        </div>

        <!-- Filter by Status -->
        <div class="col-md-2">
          <label for="statusFilter" class="form-label">Status</label>
          <select name="status" id="statusFilter" class="form-control">
            <option value="">All Statuses</option>
            <option value="Not Started" <%= currentFilter.status === 'Not Started' ? 'selected' : '' %>>Not Started</option>
            <option value="In Progress" <%= currentFilter.status === 'In Progress' ? 'selected' : '' %>>In Progress</option>
            <option value="Completed" <%= currentFilter.status === 'Completed' ? 'selected' : '' %>>Completed</option>
          </select>
        </div>

        <!-- Sort By -->
        <div class="col-md-2">
          <label for="sortFilter" class="form-label">Sort By</label>
          <select name="sort" id="sortFilter" class="form-control">
            <option value="dateAdded" <%= currentFilter.sort === 'dateAdded' || !currentFilter.sort ? 'selected' : '' %>>Date Added</option>
            <option value="title" <%= currentFilter.sort === 'title' ? 'selected' : '' %>>Title</option>
            <option value="releaseYear" <%= currentFilter.sort === 'releaseYear' ? 'selected' : '' %>>Year</option>
          </select>
        </div>

        <!-- Buttons -->
        <div class="col-md-2">
          <button type="submit" class="btn btn-primary w-100 mb-2">
            Apply<i class="fa-solid fa-filter me-1"></i>
          </button>
          <a href="/catalog" class="btn btn-outline-dark w-100">
            Clear<i class="fa-solid fa-rotate-right me-1"></i>
          </a>
        </div>

      </div>
    </form>
  </div>

  <!-- Results Count -->
  <div class="mb-3" style="animation: fadeInUp 1s ease-out;">
    <p class="text-muted">
      Showing <strong><%= items.length %></strong> 
      <% if (currentFilter.search || currentFilter.type || currentFilter.status) { %>
        of <strong><%= stats.total %></strong>
      <% } %>
      item(s)
    </p>
  </div>

  <div class="table-responsive" style="animation: fadeInUp 1s ease-out;">
    <table class="table table-bordered table-hover">
      <thead class="thead-dark">
        <tr>
          <th scope="col">Type</th>
          <th scope="col">Title</th>
          <th scope="col">Director</th>
          <th scope="col">Year</th>
          <th scope="col">Status</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% if (items && items.length > 0) { %>
          <% items.forEach(item => { %>
            <tr>
              <td>
                <span class="badge <%= item.type === 'movie' ? 'bg-primary' : 'bg-info' %>">
                  <%= item.type === 'movie' ? 'Movie' : 'Show' %>
                </span>
              </td>
              <td><strong><%= item.title %></strong></td>
              <td><%= item.director || 'N/A' %></td>
              <td><%= item.releaseYear %></td>
              <td>
                <% 
                  let statusClass = 'secondary';
                  if (item.status === 'Completed') statusClass = 'success';
                  else if (item.status === 'In Progress') statusClass = 'warning';
                %>
                <span class="badge bg-<%= statusClass %>"><%= item.status %></span>
              </td>
              <td>
                <a href="/item/<%= item._id %>/edit" class="btn btn-sm btn-primary">Edit</a>
                <form action="/item/<%= item._id %>/delete" method="POST" style="display: inline;" 
                      onsubmit="return confirm('Delete?');">
                  <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                </form>
              </td>
            </tr>
          <% }); %>
        <% } else { %>
          <tr>
            <td colspan="6" class="text-center py-4">
              <p>No items yet. <a href="/additem">Add your first item!</a></p>
            </td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>

  <div class="text-right mb-3" style="animation: fadeInUp 1s ease-out;">
    <a href="/additem" class="btn btn-primary">Add Movie/Show</a>
  </div>
</div>
